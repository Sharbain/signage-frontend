1Ô∏è‚É£ New Page: group.html

Create:

/public/group.html


Paste this full code (you can tweak texts/colors later):

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Group Control</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f5f6f7;
    }

    #container {
      display: grid;
      grid-template-columns: 320px 1fr 380px;
      height: 100vh;
    }

    /* LEFT: Group info */
    #leftPanel {
      background: #fff;
      border-right: 1px solid #ddd;
      padding: 20px;
      overflow-y: auto;
    }
    #leftPanel h2 {
      margin-top: 0;
    }
    .meta-row {
      margin-bottom: 6px;
      font-size: 14px;
    }
    .meta-row strong {
      display: inline-block;
      width: 110px;
    }

    /* MIDDLE: Devices in group + bulk controls */
    #middlePanel {
      padding: 20px;
      overflow-y: auto;
    }
    #devicesTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 14px;
    }
    #devicesTable th, #devicesTable td {
      border-bottom: 1px solid #e0e0e0;
      padding: 6px 4px;
      text-align: left;
    }
    #devicesTable tr:hover {
      background: #f5f5f5;
    }
    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 4px;
    }
    .online { background: #4caf50; }
    .offline { background: #f44336; }

    .bulk-controls button {
      margin: 4px;
      padding: 8px 10px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 13px;
    }
    .bulk-primary {
      background: #4a7c59;
      color: #fff;
    }
    .bulk-secondary {
      background: #e0e0e0;
      color: #333;
    }

    /* RIGHT: Template & group-level content control */
    #rightPanel {
      background: #fff;
      border-left: 1px solid #ddd;
      padding: 20px;
      overflow-y: auto;
    }
    .tpl-card {
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 15px;
      font-size: 14px;
    }
    .zoneCard {
      background: #fafafa;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .btn-small {
      padding: 6px 10px;
      font-size: 12px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background: #4a7c59;
      color: #fff;
    }
  </style>
</head>
<body>

<div id="container">

  <!-- LEFT PANEL: GROUP INFO -->
  <div id="leftPanel">
    <h2>üë• Group Control</h2>
    <div class="meta-row"><strong>Group ID:</strong> <span id="grpId">-</span></div>
    <div class="meta-row"><strong>Name:</strong> <span id="grpName">-</span></div>
    <div class="meta-row"><strong>Location:</strong> <span id="grpLocation">-</span></div>
    <div class="meta-row"><strong>Devices:</strong> <span id="grpDeviceCount">-</span></div>
    <div class="meta-row"><strong>Monthly views:</strong> <span id="grpViews">-</span></div>
    <div class="meta-row"><strong>Contact:</strong> <span id="grpContact">-</span></div>

    <h3>Notes</h3>
    <div id="grpNotes" style="font-size:13px; white-space:pre-wrap; background:#fafafa; border-radius:8px; padding:8px; min-height:60px;">
      -
    </div>

    <hr/>

    <h3>Group Actions</h3>
    <button class="bulk-primary" onclick="rebootGroup()">üîÑ Reboot All</button>
    <button class="bulk-secondary" onclick="restartAppGroup()">‚ôª Restart App</button>
    <button class="bulk-secondary" onclick="screenshotGroup()">üì∏ Request Screenshots</button>
    <button class="bulk-secondary" onclick="publishGroup()">üì° Publish to Group</button>

    <hr/>
    <button class="bulk-secondary" onclick="window.location.href='/'">‚¨Ö Back to Dashboard</button>
  </div>

  <!-- MIDDLE PANEL: DEVICES LIST + BULK CONTROLS -->
  <div id="middlePanel">
    <h2>Devices in Group</h2>
    <div style="font-size:13px; margin-bottom:8px;">
      Select devices below for bulk operations, or apply to the whole group from the left panel.
    </div>

    <div class="bulk-controls">
      <button class="bulk-secondary" onclick="selectAllDevices(true)">Select All</button>
      <button class="bulk-secondary" onclick="selectAllDevices(false)">Clear</button>
      <button class="bulk-primary" onclick="setBrightnessSelected(50)">üí° Brightness 50%</button>
      <button class="bulk-primary" onclick="setBrightnessSelected(100)">üîÜ Brightness 100%</button>
      <button class="bulk-primary" onclick="setVolumeSelected(0)">üîá Mute</button>
      <button class="bulk-primary" onclick="setVolumeSelected(60)">üîä Volume 60%</button>
    </div>

    <table id="devicesTable">
      <thead>
        <tr>
          <th></th>
          <th>Status</th>
          <th>Device</th>
          <th>Location</th>
          <th>Brightness</th>
          <th>Volume</th>
        </tr>
      </thead>
      <tbody id="devicesTbody"></tbody>
    </table>
  </div>

  <!-- RIGHT PANEL: TEMPLATE + ZONES -->
  <div id="rightPanel">
    <h2>Group Template</h2>
    <div class="tpl-card">
      <div><strong>Template:</strong> <span id="tplName">-</span></div>
      <div><strong>Description:</strong> <span id="tplDesc">-</span></div>
      <div style="margin-top:8px;">
        <button class="btn-small" onclick="openTemplateDesigner()">üé® Edit Template</button>
        <button class="btn-small" onclick="changeTemplateForGroup()">üîÅ Change Template</button>
      </div>
    </div>

    <h3>Zones (Group-Level)</h3>
    <div id="zoneList"></div>
  </div>

</div>

<script>
  const groupId = new URLSearchParams(window.location.search).get('id');
  document.getElementById('grpId').innerText = groupId || '-';

  // Load group info + devices + template
  async function loadGroup() {
    const res = await fetch(`/api/groups/${groupId}`);
    const group = await res.json();

    document.getElementById('grpName').innerText = group.name;
    document.getElementById('grpLocation').innerText = group.location || '-';
    document.getElementById('grpDeviceCount').innerText = group.deviceCount || (group.devices ? group.devices.length : 0);
    document.getElementById('grpViews').innerText = group.monthlyViews || '-';
    document.getElementById('grpContact').innerText = group.contact || '-';
    document.getElementById('grpNotes').innerText = group.notes || '-';

    loadGroupDevices();
    loadGroupTemplate(group.templateId);
  }

  async function loadGroupDevices() {
    const res = await fetch(`/api/groups/${groupId}/devices`);
    const devices = await res.json();

    const tbody = document.getElementById('devicesTbody');
    tbody.innerHTML = '';

    devices.forEach(dev => {
      const tr = document.createElement('tr');

      tr.innerHTML = `
        <td><input type="checkbox" class="devCheck" value="${dev.id}"></td>
        <td>
          <span class="status-dot ${dev.online ? 'online' : 'offline'}"></span>
          ${dev.online ? 'Online' : 'Offline'}
        </td>
        <td>
          <a href="/device.html?id=${dev.id}" target="_blank">${dev.name || dev.id}</a>
        </td>
        <td>${dev.city || ''} ${dev.area || ''}</td>
        <td>${dev.brightness ?? '-'}</td>
        <td>${dev.volume ?? '-'}</td>
      `;

      tbody.appendChild(tr);
    });
  }

  async function loadGroupTemplate(tplId) {
    if (!tplId) return;
    const res = await fetch(`/api/templates/${tplId}`);
    const tpl = await res.json();

    document.getElementById('tplName').innerText = tpl.name;
    document.getElementById('tplDesc').innerText = tpl.description || '';

    const zoneList = document.getElementById('zoneList');
    zoneList.innerHTML = '';

    tpl.zones.forEach(z => {
      const div = document.createElement('div');
      div.className = 'zoneCard';
      div.innerHTML = `
        <strong>${z.name}</strong><br/>
        Type: ${z.type}<br/>
        Size: ${z.width.toFixed(1)}% √ó ${z.height.toFixed(1)}%<br/>
        Position: (${z.x.toFixed(1)}%, ${z.y.toFixed(1)}%)<br/>
        <button class="btn-small" onclick="configureGroupZone('${z.id}')">‚öô Group Content</button>
      `;
      zoneList.appendChild(div);
    });
  }

  // Helpers
  function getSelectedDeviceIds() {
    return Array.from(document.querySelectorAll('.devCheck:checked')).map(cb => cb.value);
  }

  function selectAllDevices(val) {
    document.querySelectorAll('.devCheck').forEach(cb => cb.checked = val);
  }

  // Bulk control for selected devices
  async function setBrightnessSelected(level) {
    const ids = getSelectedDeviceIds();
    if (!ids.length) return alert('Select at least one device');

    await fetch('/api/devices/bulk/brightness', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ deviceIds: ids, level })
    });
    alert('Brightness command sent');
  }

  async function setVolumeSelected(level) {
    const ids = getSelectedDeviceIds();
    if (!ids.length) return alert('Select at least one device');

    await fetch('/api/devices/bulk/volume', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ deviceIds: ids, level })
    });
    alert('Volume command sent');
  }

  // Group-level actions (all devices in group)
  async function rebootGroup() {
    await fetch(`/api/groups/${groupId}/reboot`, { method: 'POST' });
    alert('Reboot command sent to group');
  }

  async function restartAppGroup() {
    await fetch(`/api/groups/${groupId}/restart-app`, { method: 'POST' });
    alert('Restart app command sent to group');
  }

  async function screenshotGroup() {
    await fetch(`/api/groups/${groupId}/screenshot`, { method: 'POST' });
    alert('Screenshot requests sent for group');
  }

  async function publishGroup() {
    await fetch(`/api/groups/${groupId}/publish`, { method: 'POST' });
    alert('Publish command sent to group');
  }

  // Template actions
  function openTemplateDesigner() {
    window.open('/template.html', '_blank');
  }

  async function changeTemplateForGroup() {
    const tplId = prompt('Enter new template ID to assign to this group:');
    if (!tplId) return;

    const res = await fetch(`/api/groups/${groupId}/template`, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ templateId: tplId })
    });

    if (res.ok) {
      alert('Template assigned to group');
      loadGroupTemplate(tplId);
    } else {
      alert('Error assigning template');
    }
  }

  function configureGroupZone(zoneId) {
    // Here you can reuse the same modal logic as device.html,
    // but calling group-level endpoints, e.g.:
    // /api/groups/:groupId/zone/:zoneId/playlist
    alert('Group zone configuration UI to be hooked here for zone ' + zoneId);
  }

  // Init
  loadGroup();
</script>
</body>
</html>